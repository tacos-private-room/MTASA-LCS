
select_radio = 0
MAX_RADIO_ID = 9
radioStations = {
    {"DOUBLE CLEF FM","src/DOUBLE.mp3"},
    {"FLASHBACK FM","src/FLASH.mp3"},
    {"HEAD RADIO","src/HEAD.mp3"},
    {"K-JAH","src/KJAH.mp3"},
    {"LCFR","src/LCFR.mp3"},
    {"THE LIBERTY JAM","src/LCJ.mp3"},
    {"LIPS 106","src/LIPS.mp3"},
    {"MSX 98","src/MSX.mp3"},
    {"RADIO DEL MUNDO","src/MUNDO.mp3"},
    {"RISE FM","src/RISE.mp3"}
}
radoPtr = nil
isUIWaitforCancelEvent = false
setRadioChannel(0)
showPlayerHudComponent( "radio", false )
function switchRadio(newval)
    if not isPedInVehicle(getLocalPlayer ()) then
        return
    end
    select_radio = select_radio + newval
    if select_radio +1 > MAX_RADIO_ID then
        select_radio  = 0
    elseif select_radio -1 < 0 then
        select_radio  = MAX_RADIO_ID
    end
    stopRadio()
    playSoundFrontEnd (34)
    updateRadioText()
    setTimer(function()
        playRadio(select_radio)
    end,2000,1)


end
function switchRandomRadio()
    select_radio = math.random(1,table.getn(radioStations))
    playSoundFrontEnd (34)
    updateRadioText()
    setTimer(function()
        playRadio(select_radio)
    end,2000,1)
end
function stopRadio()
    if radoPtr then
        stopSound(radoPtr)
    end
end
function playRadio(id)
    playSoundFrontEnd (35)
    if id == 0 then
        stopRadio()
        return
    end
    local vol = 0.5
    stopRadio()
    -- 随机播放位置

    radoPtr = playSound(radioStations[id][2],true)
    local len = getSoundLength(radoPtr)
    local pos = math.random(0,len)
    setSoundVolume(radoPtr,vol)
    setSoundPosition (radoPtr, pos)
    --outputChatBox("[电台]: 切换->"..radioStations[id][1])
    updateRadioText()
end

function updateRadioText()
    if not isUIWaitforCancelEvent then
        addEventHandler("onClientRender", getRootElement(), drawRadioText)
        isUIWaitforCancelEvent = true
        setTimer(function()
            removeEventHandler("onClientRender",root,drawRadioText)
            isUIWaitforCancelEvent = false
        end,5000,1)
    end

end
addEventHandler( "onClientKey", root, function(button,press)
    if button == "mouse_wheel_up" then
        switchRadio(1)
    elseif button == "mouse_wheel_down" then
        switchRadio(-1)
    end
end )

local screenW, screenH = guiGetScreenSize()

function drawRadioText()
    if select_radio == 0 then return end
    local name = radioStations[select_radio][1]
    dxDrawText(name, (screenW * 0.4006) + 1, (screenH * 0.0420) + 1, (screenW * 0.5994) + 1, (screenH * 0.1113) + 1, tocolor(0, 0, 0, 255), 1.50, "bankgothic", "center", "center", false, false, false, false, false)
    dxDrawText(name, screenW * 0.4006, screenH * 0.0420, screenW * 0.5994, screenH * 0.1113, tocolor(206, 238, 245, 255), 1.50, "bankgothic", "center", "center", false, false, false, false, false)
end

addEventHandler("onClientVehicleStartEnter", getRootElement(), function()
    setRadioChannel(0)
end)
addEventHandler("onClientVehicleEnter", getRootElement(), function()
    switchRandomRadio()
end)
addEventHandler("onClientPlayerVehicleExit", getRootElement(), function()
    stopRadio()
end)
addEventHandler("onClientPlayerRadioSwitch", getRootElement(), function()
    cancelEvent()
end)